#!/bin/bash
#SBATCH --cpus-per-task=6
#SBATCH --mem=6G
#SBATCH --time=0-8:00
#SBATCH --output=%j-%N.out
#SBATCH --account=aip-lelis
#SBATCH --array=0-149

module load flexiblas
export FLEXIBLAS=blis2

source envs/venv/bin/activate

# Expanded parameter ranges
learning_rates=(0.0005 0.001 0.005 0.01 0.05)
clip_coefs=(0.1 0.15 0.2 0.3 0.4 0.5)
ent_coefs=(0.0 0.01 0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4)


# Experimental
exp_list=(
    "0.0005 0.5 0.0"
    "0.0005 0.5 0.01"
    "0.0005 0.5 0.05"
    "0.0005 0.5 0.1"
    "0.0005 0.5 0.15"
    "0.0005 0.5 0.2"
    "0.0005 0.5 0.25"
    "0.0005 0.5 0.3"
    "0.0005 0.5 0.35"
    "0.0005 0.5 0.4"
    "0.001 0.5 0.0"
    "0.001 0.5 0.01"
    "0.001 0.5 0.05"
    "0.001 0.5 0.1"
    "0.001 0.5 0.15"
    "0.001 0.5 0.2"
    "0.001 0.5 0.25"
    "0.001 0.5 0.3"
    "0.001 0.5 0.35"
    "0.001 0.5 0.4"
    "0.005 0.5 0.0"
    "0.005 0.5 0.01"
    "0.005 0.5 0.05"
    "0.005 0.5 0.1"
    "0.005 0.5 0.15"
    "0.005 0.5 0.2"
    "0.005 0.5 0.25"
    "0.005 0.5 0.3"
    "0.005 0.5 0.35"
    "0.005 0.5 0.4"
    "0.01 0.1 0.0"
    "0.01 0.1 0.01"
    "0.01 0.1 0.05"
    "0.01 0.1 0.1"
    "0.01 0.1 0.15"
    "0.01 0.1 0.2"
    "0.01 0.1 0.25"
    "0.01 0.1 0.3"
    "0.01 0.1 0.35"
    "0.01 0.1 0.4"
    "0.01 0.15 0.0"
    "0.01 0.15 0.01"
    "0.01 0.15 0.05"
    "0.01 0.15 0.1"
    "0.01 0.15 0.15"
    "0.01 0.15 0.2"
    "0.01 0.15 0.25"
    "0.01 0.15 0.3"
    "0.01 0.15 0.35"
    "0.01 0.15 0.4"
    "0.01 0.2 0.0"
    "0.01 0.2 0.01"
    "0.01 0.2 0.05"
    "0.01 0.2 0.1"
    "0.01 0.2 0.15"
    "0.01 0.2 0.2"
    "0.01 0.2 0.25"
    "0.01 0.2 0.3"
    "0.01 0.2 0.35"
    "0.01 0.2 0.4"
    "0.01 0.3 0.0"
    "0.01 0.3 0.01"
    "0.01 0.3 0.05"
    "0.01 0.3 0.1"
    "0.01 0.3 0.15"
    "0.01 0.3 0.2"
    "0.01 0.3 0.25"
    "0.01 0.3 0.3"
    "0.01 0.3 0.35"
    "0.01 0.3 0.4"
    "0.01 0.4 0.0"
    "0.01 0.4 0.01"
    "0.01 0.4 0.05"
    "0.01 0.4 0.1"
    "0.01 0.4 0.15"
    "0.01 0.4 0.2"
    "0.01 0.4 0.25"
    "0.01 0.4 0.3"
    "0.01 0.4 0.35"
    "0.01 0.4 0.4"
    "0.01 0.5 0.0"
    "0.01 0.5 0.01"
    "0.01 0.5 0.05"
    "0.01 0.5 0.1"
    "0.01 0.5 0.15"
    "0.01 0.5 0.2"
    "0.01 0.5 0.25"
    "0.01 0.5 0.3"
    "0.01 0.5 0.35"
    "0.01 0.5 0.4"
    "0.05 0.1 0.0"
    "0.05 0.1 0.01"
    "0.05 0.1 0.05"
    "0.05 0.1 0.1"
    "0.05 0.1 0.15"
    "0.05 0.1 0.2"
    "0.05 0.1 0.25"
    "0.05 0.1 0.3"
    "0.05 0.1 0.35"
    "0.05 0.1 0.4"
    "0.05 0.15 0.0"
    "0.05 0.15 0.01"
    "0.05 0.15 0.05"
    "0.05 0.15 0.1"
    "0.05 0.15 0.15"
    "0.05 0.15 0.2"
    "0.05 0.15 0.25"
    "0.05 0.15 0.3"
    "0.05 0.15 0.35"
    "0.05 0.15 0.4"
    "0.05 0.2 0.0"
    "0.05 0.2 0.01"
    "0.05 0.2 0.05"
    "0.05 0.2 0.1"
    "0.05 0.2 0.15"
    "0.05 0.2 0.2"
    "0.05 0.2 0.25"
    "0.05 0.2 0.3"
    "0.05 0.2 0.35"
    "0.05 0.2 0.4"
    "0.05 0.3 0.0"
    "0.05 0.3 0.01"
    "0.05 0.3 0.05"
    "0.05 0.3 0.1"
    "0.05 0.3 0.15"
    "0.05 0.3 0.2"
    "0.05 0.3 0.25"
    "0.05 0.3 0.3"
    "0.05 0.3 0.35"
    "0.05 0.3 0.4"
    "0.05 0.4 0.0"
    "0.05 0.4 0.01"
    "0.05 0.4 0.05"
    "0.05 0.4 0.1"
    "0.05 0.4 0.15"
    "0.05 0.4 0.2"
    "0.05 0.4 0.25"
    "0.05 0.4 0.3"
    "0.05 0.4 0.35"
    "0.05 0.4 0.4"
    "0.05 0.5 0.0"
    "0.05 0.5 0.01"
    "0.05 0.5 0.05"
    "0.05 0.5 0.1"
    "0.05 0.5 0.15"
    "0.05 0.5 0.2"
    "0.05 0.5 0.25"
    "0.05 0.5 0.3"
    "0.05 0.5 0.35"
    "0.05 0.5 0.4"
)

# Calculate indexes
idx=$SLURM_ARRAY_TASK_ID

read -r lr clip ent <<< "${exp_list[$idx]}"

echo "Running job $idx with:"
echo "  Learning rate: $lr"
echo "  Clip coef: $clip"
echo "  Entropy coef: $ent"

OMP_NUM_THREADS=1 python -m pipelines.parameter_sweep_testing \
  --seed=0 \
  --learning_rate=$lr \
  --clip_coef=$clip \
  --ent_coef=$ent