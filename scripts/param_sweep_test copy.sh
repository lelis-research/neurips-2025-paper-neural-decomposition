#!/bin/bash
#SBATCH --cpus-per-task=1
#SBATCH --mem=1G
#SBATCH --time=0-0:30
#SBATCH --output=%j-%N.out
#SBATCH --account=aip-lelis
#SBATCH --array=0-155  # Adjust based on number of configs below

module load flexiblas
export FLEXIBLAS=blis2

source envs/venv/bin/activate

# Each string contains: "learning_rate clip_coef entropy_coef seed"
configs=(
  "0.05 0.5 0.35 2"
  "0.0005 0.2 0.05 2"
  "0.0005 0.2 0.1 0"
  "0.0005 0.2 0.1 1"
  "0.0005 0.2 0.1 2"
  "0.0005 0.2 0.15 0"
  "0.0005 0.2 0.15 1"
  "0.0005 0.2 0.15 2"
  "0.0005 0.2 0.2 0"
  "0.0005 0.2 0.2 1"
  "0.0005 0.2 0.2 2"
  "0.0005 0.2 0.25 0"
  "0.0005 0.2 0.25 1"
  "0.0005 0.2 0.25 2"
  "0.0005 0.2 0.3 0"
  "0.0005 0.2 0.3 1"
  "0.0005 0.2 0.3 2"
  "0.0005 0.2 0.35 0"
  "0.0005 0.2 0.35 1"
  "0.0005 0.2 0.35 2"
  "0.0005 0.3 0.01 0"
  "0.0005 0.3 0.01 1"
  "0.0005 0.3 0.01 2"
  "0.0005 0.3 0.05 0"
  "0.0005 0.3 0.05 1"
  "0.0005 0.3 0.05 2"
  "0.0005 0.3 0.1 0"
  "0.0005 0.3 0.1 1"
  "0.0005 0.3 0.1 2"
  "0.0005 0.3 0.15 0"
  "0.0005 0.3 0.15 1"
  "0.0005 0.3 0.15 2"
  "0.0005 0.3 0.2 0"
  "0.0005 0.3 0.2 1"
  "0.0005 0.3 0.2 2"
  "0.0005 0.3 0.25 0"
  "0.0005 0.3 0.25 1"
  "0.0005 0.3 0.25 2"
  "0.0005 0.3 0.3 0"
  "0.0005 0.3 0.3 1"
  "0.0005 0.3 0.3 2"
  "0.0005 0.3 0.35 0"
  "0.0005 0.3 0.35 1"
  "0.0005 0.3 0.35 2"
  "0.0005 0.4 0.01 0"
  "0.0005 0.4 0.01 1"
  "0.0005 0.4 0.01 2"
  "0.0005 0.4 0.05 0"
  "0.0005 0.4 0.05 1"
  "0.0005 0.4 0.05 2"
  "0.0005 0.4 0.1 0"
  "0.0005 0.4 0.1 1"
  "0.0005 0.4 0.1 2"
  "0.0005 0.4 0.15 0"
  "0.0005 0.4 0.15 1"
  "0.0005 0.4 0.15 2"
  "0.0005 0.4 0.2 0"
  "0.0005 0.4 0.2 1"
  "0.001 0.3 0.25 0"
  "0.001 0.3 0.25 1"
  "0.001 0.3 0.25 2"
  "0.001 0.3 0.3 0"
  "0.001 0.3 0.3 1"
  "0.001 0.3 0.3 2"
  "0.001 0.3 0.35 0"
  "0.001 0.3 0.35 1"
  "0.001 0.3 0.35 2"
  "0.001 0.4 0.01 0"
  "0.001 0.4 0.01 1"
  "0.001 0.4 0.01 2"
  "0.001 0.4 0.05 0"
  "0.001 0.4 0.05 1"
  "0.001 0.4 0.05 2"
  "0.001 0.4 0.1 0"
  "0.001 0.4 0.1 1"
  "0.001 0.4 0.1 2"
  "0.001 0.4 0.15 0"
  "0.001 0.4 0.15 1"
  "0.001 0.4 0.15 2"
  "0.001 0.4 0.2 0"
  "0.001 0.4 0.2 1"
  "0.001 0.4 0.2 2"
  "0.001 0.4 0.25 0"
  "0.001 0.4 0.25 1"
  "0.001 0.4 0.25 2"
  "0.001 0.4 0.3 0"
  "0.001 0.4 0.3 1"
  "0.001 0.4 0.3 2"
  "0.001 0.4 0.35 0"
  "0.001 0.4 0.35 1"
  "0.001 0.4 0.35 2"
  "0.001 0.5 0.01 0"
  "0.001 0.5 0.01 1"
  "0.001 0.5 0.01 2"
  "0.001 0.5 0.05 0"
  "0.001 0.5 0.05 1"
  "0.001 0.5 0.05 2"
  "0.001 0.5 0.1 0"
  "0.001 0.5 0.1 1"
  "0.001 0.5 0.1 2"
  "0.001 0.5 0.15 0"
  "0.001 0.5 0.15 1"
  "0.001 0.5 0.15 2"
  "0.001 0.5 0.2 0"
  "0.001 0.5 0.2 1"
  "0.001 0.5 0.2 2"
  "0.001 0.5 0.25 0"
  "0.001 0.5 0.25 1"
  "0.001 0.5 0.25 2"
  "0.001 0.5 0.3 0"
  "0.001 0.5 0.3 1"
  "0.001 0.5 0.3 2"
  "0.001 0.5 0.35 0"
  "0.001 0.5 0.35 1"
  "0.001 0.5 0.35 2"
  "0.005 0.1 0.01 0"
  "0.005 0.1 0.01 1"
  "0.005 0.1 0.01 2"
  "0.005 0.1 0.05 0"
  "0.005 0.1 0.05 1"
  "0.05 0.4 0.15 2"
  "0.05 0.4 0.2 0"
  "0.05 0.4 0.2 1"
  "0.05 0.4 0.2 2"
  "0.05 0.4 0.25 0"
  "0.05 0.4 0.25 1"
  "0.05 0.4 0.25 2"
  "0.05 0.4 0.3 0"
  "0.05 0.4 0.3 1"
  "0.05 0.4 0.3 2"
  "0.05 0.4 0.35 0"
  "0.05 0.4 0.35 1"
  "0.05 0.4 0.35 2"
  "0.05 0.5 0.01 0"
  "0.05 0.5 0.01 1"
  "0.05 0.5 0.01 2"
  "0.05 0.5 0.05 0"
  "0.05 0.5 0.05 1"
  "0.05 0.5 0.05 2"
  "0.05 0.5 0.1 0"
  "0.05 0.5 0.1 1"
  "0.05 0.5 0.1 2"
  "0.05 0.5 0.15 0"
  "0.05 0.5 0.15 1"
  "0.05 0.5 0.15 2"
  "0.05 0.5 0.2 0"
  "0.05 0.5 0.2 1"
  "0.05 0.5 0.2 2"
  "0.05 0.5 0.25 0"
  "0.05 0.5 0.25 1"
  "0.05 0.5 0.25 2"
  "0.05 0.5 0.3 0"
  "0.05 0.5 0.3 1"
  "0.05 0.5 0.3 2"
  "0.05 0.5 0.35 0"
  "0.05 0.5 0.35 1"
)

# Get the config line for this SLURM_ARRAY_TASK_ID
config="${configs[$SLURM_ARRAY_TASK_ID]}"

# Split config into variables
read lr clip ent seed <<< "$config"

echo "Running job $SLURM_ARRAY_TASK_ID with:"
echo "  Learning rate: $lr"
echo "  Clip coef: $clip"
echo "  Entropy coef: $ent"
echo "  Seed: $seed"

OMP_NUM_THREADS=1 python -m pipelines.parameter_sweep_testing \
  --seed=$seed \
  --learning_rate=$lr \
  --clip_coef=$clip \
  --ent_coef=$ent